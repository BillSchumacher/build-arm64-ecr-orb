description: >
  Configures aws cli, builds a docker image and pushes it to ecr.

executor: default

orbs:
  aws-ecr: circleci/aws-ecr@8.1.2
  aws-ecs: circleci/aws-ecs@2.2.1

parameters:
  profile:
    type: string
    default: "default"
    description: "aws profile"
  dockerfile:
    type: string
    default: "Dockerfile"
    description: "the dockerfile"
steps:
  - checkout
  - run:
      name: "Configure AWS"
      environment:
        PARAM_PROFILE: <<parameters.profile>>
      command: <<include(scripts/configure-aws.sh)>>
  - run:
      name: "Build docker image and push"

      environment:
        PARAM_DOCKERFILE: <<parameters.dockerfile>>
      command: <<include(scripts/build-and-deploy.sh)>>
